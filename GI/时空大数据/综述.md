# 时空大数据管理与应用的最新进展综述

时空数据同时拥有时间和空间两个特征，是一种结构复杂的多维数据，作为最典 型的大数据之一，其量级也非常庞大。太空望远镜每周能收集约 150GB 的时空数据， 而美国宇航局（NASA）的航天器每天能收集约 4TB 的数据。时空数据作为最重要的 大数据之一，其在日常生活中的各个领域正发挥着积极作用，例如打车行业、交通监 控和智慧城市等。时空大数据的价值在于分析其时间、空间、对象之间的关联关系并 对其背后隐藏的规律进行发掘与利用。因此，如何对海量庞杂的时空数据进行高效的 存储、组织、管理和查询是目前亟需解决的问题，同时也是现在热点的研究对象。



## 时空数据库的应用和研究现状

时空数据库（Spatiao-Temporal Database）是可以同时支持空间维度与时间维度两 种特性的数据存储和管理系统，是 20 世纪 90 年代诞生的科研领域。发展至今，国内 外在该领域都取得了一定的研究成果。

国外欧美国家在时空数据库领域起步较早，在学术研究方面位于世界前列。时空 数据库领域里著名的研究学者 Ralf H.Güting 和 Markus Schneider 著有《Moving Objects Databases》[19]一书，该书籍系统性地介绍了关于移动对象的数据模型、索引结构和 查询方法等内容，在当前该领域中具有相当高的参考价值。国外学者们也提出了各种 时空数据模型，为时空数据库的发展贡献了自己的一份力量。例如，Langran 提出了 时间快照模型以及在此基础之上改进后的基态修正模型[20]；Wolfson 与 Vazirgiannis 针对移动对象提出了 MOST 模型[21]，该模型能描述对象当前和预计未来的移动情况； Yeh 等人通过时间函数将时间属性与空间属性集成起来，提出了 BTS 时空模型[22][23]。 国内虽然在时空数据库领域起步较晚，但最近几年已有不少高校平台、公司企业 和研究机构在该领域奋起直追，如浙江大学、北京大学、滴滴公司和中科院等，并且 也取得了一定成果。浙江大学的高云君[24]对时空数据库查询处理中的关键技术进行了 研究，包括并行最近邻查询、并行 Skyline 查询和历史连续 kNN 查询等，丰富了国内 在时空查询技术方面的理论。北京测绘的王天明和李莹等人[25]对智慧城市云平台下的 时空数据库进行了相关设计与研究。中科院的丁治明[26]对移动数据库中的关键技术进 行了研究，包括移动数据库复制技术、离散时空轨迹数据库模型和相关移动对象索引 算法等，提高了移动数据库的处理能力和灵活性。

时空索引作为时空数据库的核心内容也在不断发展壮大，时空索引通常由空间索 引变形或扩展所得，目前大部分时空索引都基于成熟的空间 R-Tree 索引[27]，并可按 查询时间分为三类：查询历史（离线）数据的时空索引，包括 RT-Tree[28]、3DR-Tree[29]、 TB-Tree[30]、HR-Tree[31]、MV3R-Tree[32]、STR-Tree[33]、SEB-Tree[34]和 SETI-Tree[35] 等；查询当前（实时）数据的时空索引，包括 Hash 索引[36]和 LUR-Tree[37]等；查询 （预测）未来数据的时空索引，包括 TPR-Tree[38]、TPR*-Tree[39]和 STAR-Tree[40]等。 每个时空索引都有其各自的侧重点，不同的时空索引适用于不同的查询场合。本文在 2.2 小节中会对其中典型的索引结构做进一步介绍。 而在商业应用方面，目前国内外还没有一个完整成熟的时空数据库产品，该领域 仍处在探索研究阶段，离真正产业化还有一段路需要奋斗。


## 时空大数据索引与查询技术
时空索引是时空数据库中最为核心的一个模块，相比于传统地理空间数据库中的 空间索引，时空索引加入了时间维信息。
### 空间R-tree索引

目前主流的时空索引大多都是以空间 R 树索引为基础经过变形扩展所得，

R 树是 Guttman 在 1984 年提出的一种针对空间数据的索引结构，现被广泛应用 于各种商业应用和原型系统中。R 树是 B 树在多维空间的扩展，一棵 M 阶的 R 树包 含两种节点：叶子节点和非叶子节点（也可称为目录节点），具体节点结构描述如下： 叶子节点：(Count , Level , <O1, MBR1> , <O2, MBR2> , „ , <OM, MBRM>)。 目录节点：(Count , Level , < P1, MBR1> , <P2, MBR2> , „ , < PM, MBRM>)。

RT-Tree 是 X.Xu 与 J.Han 等人在 1990 年提出的索引结构，是空间 R-Tree 的一种 时空扩展。RT-Tree 将时间信息一起插入到空间 R-Tree 的节点上进行存储。其基本存 储格式为<S，T，P>，其中 S 代表移动对象空间信息（地理位置），T 代表对象维持 处在当前空间位置上的时间间隔，而 P 则代表指向该移动对象的指针。移动对象的地 理空间位置若保持不变，则只需更新时间信息 T 即可；若 S 一旦发生变化，则会产 生新的<S，T，P>索引项插入到树中。因此，RT-Tree 适用于移动对象空间位置更新 频率较低的时空数据库，


R 树[7]最早是由 Guttman 于 1984 年提出，是空间索引领域中非常重要的一 种索引结构[8]。R 树可以看成是 B 树[9]在多维空间上的自然扩展，具有高度的平 衡性。从逻辑层面上看，R 树的每一个节点对应着数据空间内的一个区域，名为 最小包围矩形（Minimal Bounding Rectangle），简称 MBR。若区域对应的节点为 R 树的非叶节点，则节点的每一个子项内将会存储一个子节点及其对应的 MBR； 若区域对应的节点为 R 树的叶节点，则节点的每一个子项内将会存储一个实际 数据对象的引用及其 MBR，但不会存储实际数据对象本身。通过 MBR 结构，R 树可以简单有效的判断在某个节点的管理范围内是否可能存在待查询的数据对 象，从而在查询过程中尽可能早的排除掉那些不包含待查询数据对象的节点。



### 网格索引

网格索引[12]是地理信息系统（GIS）中常用的空间索引之一。其思想是使用 一定大小的网格将整个空间区域进行划分，则每个区域可看成是一个类似桶的数 据存储结构，负责维护进入该区域内的实际数据点，每个数据点都将唯一落在一 个网格中[13]。当 需要插入或删除一个数据点时，只需要根据其空间坐标就可以计 算得出其所归属的网格范围，然后将其简单加入或删除即可。一般来说，影响网 格索引性能的关键在于网格大小的选择。网格越大，对应的网格索引表的记录数 就越少，但是平均每个网格内的数据点数也就会越多，同时不同数据点落在同一 个网格中的几率也会越高；反之，网格越小，网格索引表中的记录数就越多，但 平均每个网格内的数据点数也会相对变少，同时不同数据点落在同一个网格中的 几率也会降低。


### 四叉树索引
四叉树[14]由 Finkel 和 Bentley 于 1974 年提出，是地理信息系统（GIS）中常 用的空间索引之一。其基本思想是：将某个已知的空间范围划分为四个子空间， 每个子空间又可以根据需要决定是否继续划分，如此递归执行直到满足某个预先 设定的终止条件。四叉树的理念与构建步骤都并不复杂，并且在空间数据对象的 分布比较均匀的情况下，数据的插入和查询效率都较高。但 相反的若空间数据对 象的分布较为倾斜，则对应于数据密集区域的四叉树的层数会持续增加，最终导 致整个四叉树结构的严重失衡，查询效率也会因此而大幅下降。一棵典型四叉树 的结构如图 2-2 所示。

### k-d 树索引
k-d 树[15]是在 k 维欧几里德空间里组织数据的一种结构，可看成是 k 维的二 叉检索树。它的每个节点都表示 k 维空间中的一个点，并且和一个矩形区域相对 应，树的根节点则和整个空间范围相对应。k-d 树要求用平行于坐标轴的横纵分 界线将空间划分为若干子区域，使得每个子区域中的数据点个数不超过某个给定 值。分界线仅仅起到划分界限的作用，它的选取没有硬性的限制，一般来说都选 用通过某个数据点的横向线或者纵向线。位于分界线上的数据点，规定对于左右 分界线来说属于右部，对于上下分界线来说属于上部。 在插入数据时，若 k-d 树为空，则插入数据点成为新的根节点；否则继续在 其左子树或右子树上查找，直到某个叶节点。此时该数据点将对应的成为该叶节 点的左子节点或右子节点。k-d 树删除节点的操作在思想与传统的二叉检索树类 似，但实际步骤却会复杂很多。由于在构建过程中会对整个空间区域按照不同的 维度进行交替式的划分，因此在对节点进行删除时还必须考虑对应子树的结构维 护问题，从而保持整棵 k-d 树的空间布局。
## 分布式时空大数据索引与查询系统实现
### 分布式概念
### hbase生态系统的实现

### spark生态系统的实现


## 结论
