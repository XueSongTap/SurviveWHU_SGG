# 基于分布式集群的机载激光雷达对地观测数据存储和计算方法

## 摘要

## 0

当今社会已经进入信息时代。三维空间数据作为信息的一种，可以表示空间物体的 位置信息和其它附加信息，人们可以根据这些信息，更进一步理解空间物体。

同时，科 学技术的发展也丰富了人们获得空间数据的手段。特别是激光雷达技术的迅猛发展，使 得获取物体表面几何信息和灰度信息变得越来越容易，促进了激光扫描技术的发展。

同 时，随着无人机 UAV（unmanned aerial vehicle）技术的日渐成熟和应用领域的不断扩展， 激光雷达也逐渐开始被安装在无人机上实行勘测任务。

机载激光扫描系统 LiDAR（Light Laser Detection and Ranging）作为一种新型的遥感系统，具有全天候、主动、实时、快 速、高效率、高密度等优点[1]。

目前，机载激光扫描系统已经在海岸带测绘、自然灾害 监测、油气管道线路测绘和道路施工勘察等多个领域有了长足的应用，同时还可以精确、 快速地生成地形、植被和建筑物的三维表面信息，应用于地形测绘、植被图绘制、城市 三维数字建模、土地沙化监测、国防边境安全等领域[2, 3, 4]。

目前机载激光扫描系统的扫 描频率已经可以达到几十万点/秒以上，理论上一次飞行可采集数亿个点[5]

虽然机载激光扫描系统得到了长足的发展，但是针对于大规模对地观测的点云数据进行存储和处理问题亟需解决，如何在分布式集群中对对地观测的点云数据进行存储和高效查询，是需要解决的问题。

## 机载激光点云对地观测
机载激光点云是经机载激光扫描系统采集，通过坐标转换到同一坐标系下的空间数 据点集，其属性主要包含三维坐标信息和激光反射强度等。机载激光点云高精度、高密 度、以及低成本的特点使其在地形测绘、深海探测、自然灾害评估等领域得到广泛的应 用。

### 机载激光扫描系统
机载激光扫描系统主要由机载系统和地面系统构成。其中机载系统主要包括激光雷 达、惯性测量单元 IMU（Inertial Measurement Unit）、全球定位系统 GNSS 移动站、嵌入 式系统及无线数据电台，其主要功能是实现各传感器数据的实时采集，并通过无线网络 传送给地面服务器。地面系统主要由无线数据电台、GNSS 基站和服务器构成。其主要 功能是完成数据接收以及后续的数据管理、处理及显示工作。机载激光雷达是机载激光 扫描系统的核心传感器，可以获取目标的距离信息，它的性能直接影响最终的点云成图 效果。惯性测量元件可以获取物体三轴的姿态角。GNSS 移动站和 GNSS 基站组成的差 分 GNSS 可为机载激光扫描系统提供厘米级的定位服务。

### 机载激光点云数据生成
机载激光点云由激光雷达、惯性测量单元 IMU 和 GNSS 的数据融合得到。激光雷 达通过扫描目标可得到与目标的距离，惯性测量单元 IMU 可得到姿态信息，GNSS 移动 站和地面 GNSS 基站可确定位置信息。通过这三类数据的融合，并进行坐标转换后，可 计算得到激光点云的坐标。其中，涉及的坐标系主要有激光雷达坐标系，惯性平台坐标 系和当地水平坐标系。

#### 激光雷达坐标系

#### 惯性平台坐标系


## 常用点云数据索引技术
网格划分、K-D 树和八叉树是三种常用的空间数据索引技术，它们均是自顶向下， 逐级对空间进行划分的索引技术

### 基于网格划分的索引技术
基于网格划分空间，实际上在是把三维空间等分为多个子空间，每个子空间都是一个三维网格，记录下每个空间内的数据。要查找某个数据的时候，只需要按照一定规则 先查找到它所在的网格，然后再在这个网格内逐一查找即可

如果把网格划分为 IJK  个子空间，那么数据查找的范围就缩小到了原查询范围的1/ ( ) IJK  。此外， 基于网格划分的方法也可以很容易地进行二次划分。如果觉得一级划分的粒度还不够细， 一个网格内的数据还是太多，可以使用同样的方法对每一个一级网格进行二级划分，对 每个二级网格进行三级划分，以此类推。类似于查找地址的场景，如果只在国家层次进 行了划分，需要直接在一个国家内精确查找某个地址，查找开销巨大，显然划分粒度太 粗。此时，可以再进行细粒度的省、市、区的划分。查找时通过所在国家、省、市、找 到所在区，再在区内精确查找地址，此时，查找效率得到明显的提升。

### 基于八叉树的索引技术
八叉树是一种树型结构，它递归地把空间平均划分为 8 个子空间。8 分三维空间是4 分二维空间和 2 分一维空间的拓展，即八叉树是四叉树、二叉树的拓展。八叉树的每 一次划分实际上就是在每个维度上都用一个面二分空间，三个维度同时进行划分之后， 得到 8 个子空间再在每个子空间中继续进行同样的划分，直到划分深度达到最大树 深。设定八叉树最大深度的原因是要定义最小子空间的外包围盒大小，即最小的划分粒 度。设划分的空间总个数为 N，插入新数据或者查找数据的时间复杂度为 8 (log ) ON。八 叉树还可以设计其它的划分终止条件，例如子空间的数据少于一个设定值就不继续划分 等。如果每个子空间都进行划分，直到最大深度，即可得到满八叉树。满八叉树可以看 作特殊的网格划分，相当于把空间划分为 222 nnn 个三维网格，n 是树的深度

八叉树的根结点表示整个待索引空间，根结点的八个指针分别指向划分出来的八个 子空间。非叶结点存放空间外包围盒的位置信息，一般有八个子结点，如果定义子空间 中无数据就停止树的划分，非叶结点就退化成叶结点，如图 2-13 所示。满八叉树的叶结 点代表最小的空间，数据的引用一般存放在叶结点上。如果数据是空间形状或者物体， 并且同时与多个空间相交的时候，数据的引用还可以设计放在非叶结点上。

传统的八叉树由于存在大量指针操作，在空间划分次数较多，树深较深的情况下效 率较低；而且大量的指针占用了巨大的存储空间。线性八叉树是一种改进八叉树，它把 每个划分子空间即每一层非叶结点、叶结点的位置信息转化成一个一维的值，使得不需 要指针操作就能定位到对应的空间[39]。使用层次 Morton 编码可以把八叉树位置信息转 换成一维值[40]，如式（2-20）所示。

其中 Morton 编码是二进制表示的， ni q − 是 3 位二进制，数值是 000 到 111，分别 表示第 i 层划分的 8 个子空间。

通过层次 Morton 编码得到的一维线性八叉树位置信息实际上与使用网格划分，把 空间划分为 222 nnn 个子空间后，再使用交叉移位组合网格编号得到的 Morton 编码是 等价的。交叉移位进行 Morton 编码，就是将网格划分后得到的网格编号的三个维度的 坐标都转换为二进制，然后依次进行交叉移位。通过网格编号 ( , , ) i j k 计算 Morton 编码 的方法可表示为式（2-21）：

### 基于 K-D 树的索引技术

K-D 树（ K-Dimension Tree）是一种空间划分树，也是二叉树的拓展，主要应用于多 维数据的搜索[41]。对于三维空间，K-D 树的 K 就是 3。K-D 树每一个结点都有一个划分 超平面与之对应。K-D 树也是通过递归的方式在 K 个维度上轮流对空间进行划分。与八 叉树不同，K-D 树的划分不是等分。这 K 个维度需要设定一个顺序，每次按设定顺序选 定一个维度后，把数据集上这个维度上的中位数作为划分值，小于该值的数据划分到左 子树，大于等于该值的数据划分到右子树，一直重复进行，直到结点里的数据量少于预 设值或者树深达到最大树深。K-D 树有如下特点，当一个结点的左子树不为空时，左子 树的所有结点的第 d 个维度的值一定小于它第 d 维的值。当一个结点的右子树不为空

时，右子树的所有结点的值一定大于或者等于它的第 d 维的值。并且该节点的左右子树 都是 K-D 树。对于有 N 个 K 维数据的数据集来说，K-D 树的建树时间复杂度是 ( log ) ON N ， 单点查询和插入复杂度在 K-D 树较为平衡的时候是 (log ) ON，邻域查询时需要回溯。此 外，还需要设计一些算法来保证 K-D 树的平衡，会有额外的开销。

## 常用点云存储技术

### mongodb数据库

MongoDB 是一种适用于海量数据读写的非关系型数据库。它是面向文档的数据库， 由数据库、集合、文档三个层次组成。


文档的键（key）和值（value）可支持多种数据类型和类型嵌套。通过文档、数组和 各种数据类型的灵活组合，可以用一条记录即一个文档表达复杂的层次关系。此外，由 于没有固定的模式，添加和删除字段变得非常容易。一个复杂的 MongoDB 文档结构如 下图所示。

### HBase 分布式数据库

HBase 是 Google Bigtable（Chang 2006）的开源实现，利用 HDFS 作为文件 存储系统，利用 MapReduce 处理海量数据，利用 ZooKeeper 作为对应的功能。 不同于一般的关系数据库，HBase 是一个适合于非结构化数据的基于列存储的 数据库。


HBase 具有如下特点：①模块化及线性可扩展性；严格一致的读写；②读 取速度快；③表的自动分片和配置；④支持 Region Server 之间的自动故障转 移；⑤易于使用的客户端访问；⑥方便基类支持 MapReduce 作业与 HBase 的 表；⑦布鲁姆过滤器实时查询和块缓存；⑧可扩展的基于 JRuby 的脚本；⑨支 持监控信息通过 Hadoop 子系统导到文件或 Ganglia


HBase 数据库的结构，与传统数据库的存储方式类似的地方是它都是由行 和列组成的。行与传统数据库类似，称之为行键（Row Key），用来检索记录的 主键；而列则有所不同，列最大的索引方式是列族（Column Family），每一个 列族下面又可以有很多列（Column），所有 Column 均以二进制格式存储，而且 不同行可以有不同的列，这是与传统数据库最不一样的地方。因此 HBase 比较灵活，数据可以根据用户自己的需要自由存放在 HBase 之中。行和列对应一个 单元格（Cell），用来存储数据，称之为值（Value），它可以由行键和列一起检 索出来。另外每一个单元格还有时间戳（Timestamp）作为区分，即相同单元格 不同时间戳的值还可能是不一样的。这样可以动态的显示表格中数据的更新。

HBase 访问接口有多种方式，不同方式的适用场景不同，HBase 的访问接口 有 Native Java API、HBase Shell、Thrift Gateway、REST Gateway、Pig 和 Hive 等几种。由于目前针对点云的可视化平台一般采用 C++语言实现，本文采用 Thrift Gateway 的方法，支持 C++、PHP、Python 等多种语言。

## 分布式架构


## 总结
